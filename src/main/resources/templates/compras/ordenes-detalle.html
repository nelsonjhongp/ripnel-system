<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Detalle OC · RIPNEL</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body th:attr="data-bs-theme=${theme}">

<div th:replace="~{_nav :: bar('Compras / Detalle OC')}"></div>

<main class="container-xxl py-4">

    <div class="card p-3 mb-3">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h2 class="h5 mb-1">Orden de compra
                    <span class="text-secondary" th:text="${order.number}">OC-0001</span>
                </h2>
                <div class="text-secondary small">
                    Proveedor:
                    <span th:text="${order.supplier != null ? order.supplier.name : '—'}">Proveedor</span><br>
                    Fecha:
                    <span th:text="${order.orderedAt}">2025-11-20</span>
                </div>
            </div>

            <div class="text-end">
                <div>
          <span class="badge"
                th:classappend="${
                  order.status.name() == 'OPEN' ? ' text-bg-warning' :
                  (order.status.name() == 'RECEIVED' ? ' text-bg-success' :
                  (order.status.name() == 'CANCELED' ? ' text-bg-danger' : ' text-bg-secondary'))
                }"
                th:text="${order.status}">
            OPEN
          </span>
                </div>
                <div class="mt-2 fw-semibold">
                    Total:
                    <span th:text="${#numbers.formatDecimal(order.total, 1,'COMMA',2,'POINT')}">
            0.00
          </span>
                </div>
            </div>
        </div>

        <div class="mt-2 text-secondary small" th:if="${order.notes != null}">
            Nota: <span th:text="${order.notes}">Texto</span>
        </div>
    </div>

    <div class="card p-3 mb-3">
        <h3 class="h6 mb-2">Materiales de la orden</h3>

        <div class="table-responsive">
            <table class="table table-sm align-middle">
                <thead>
                <tr>
                    <th>Material</th>
                    <th class="text-end">Cant. pedida</th>
                    <th class="text-end">Cant. recibida</th>
                    <th class="text-end">Costo unit. (S/)</th>
                    <th class="text-end">Subtotal (S/)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="it : ${order.items}">
                    <td th:text="${it.material != null ? it.material.name : '—'}">Tela X</td>
                    <td class="text-end" th:text="${it.qty}">0.00</td>
                    <td class="text-end" th:text="${it.receivedQty}">0.00</td>
                    <td class="text-end" th:text="${it.unitCost}">0.00</td>
                    <td class="text-end" th:text="${it.subtotal}">0.00</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="d-flex gap-2">
        <a th:href="@{/compras/ordenes}" class="btn btn-outline-secondary">
            Volver
        </a>

        <form th:if="${order.status.name() != 'RECEIVED' and order.status.name() != 'CANCELED'}"
              th:action="@{'/compras/ordenes/' + ${order.id} + '/recibir'}"
              method="post">
            <button type="submit" class="btn btn-success">
                Marcar como recibida (actualizar stock)
            </button>
        </form>
    </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
