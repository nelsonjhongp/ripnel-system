<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>Nueva OC · RIPNEL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet">
  <!-- Estilos propios -->
  <link th:href="@{/css/app.css}" rel="stylesheet">
</head>
<body th:attr="data-bs-theme=${theme}">

<!-- NAV -->
<div th:replace="~{_nav :: bar('Compras / Nueva OC')}"></div>

<main class="container-xxl py-4">

  <div class="card p-3">
    <h2 class="h5 mb-3">Nueva orden de compra</h2>

    <form th:action="@{/compras/ordenes}"
          th:object="${form}"
          method="post"
          class="row g-3">

      <!-- PROVEEDOR + FECHA -->
      <div class="col-12 col-md-6">
        <label class="form-label">Proveedor</label>
        <select class="form-select" th:field="*{supplierId}" required>
          <option value="">Seleccione...</option>
          <option th:each="s : ${suppliers}"
                  th:value="${s.id}"
                  th:text="${s.name}">
          </option>
        </select>
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Fecha</label>
        <input type="date" class="form-control" th:field="*{orderedAt}">
      </div>

      <div class="col-12">
        <label class="form-label">Notas</label>
        <textarea class="form-control"
                  rows="2"
                  th:field="*{notes}"
                  placeholder="Ej. OC para reposición mensual de telas"></textarea>
      </div>

      <!-- ÍTEMS -->
      <div class="col-12">
        <h3 class="h6 mt-2 mb-2">Materiales</h3>

        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead>
            <tr>
              <th>Material</th>
              <th style="width:120px;" class="text-end">Cantidad</th>
              <th style="width:150px;" class="text-end">Costo unit. (S/)</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="item, stat : *{items}">
              <!-- Material -->
              <td>
                <select class="form-select"
                        th:field="*{items[__${stat.index}__].materialId}">
                  <option value="">— Seleccionar —</option>
                  <option th:each="m : ${materials}"
                          th:value="${m.id}"
                          th:text="${m.code + ' · ' + m.name}">
                  </option>
                </select>
              </td>

              <!-- Cantidad -->
              <td>
                <input type="number"
                       min="0"
                       step="0.01"
                       class="form-control text-end"
                       th:field="*{items[__${stat.index}__].qty}">
              </td>

              <!-- Costo unitario -->
              <td>
                <input type="number"
                       min="0"
                       step="0.01"
                       class="form-control text-end"
                       th:field="*{items[__${stat.index}__].unitCost}">
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- BOTONES -->
      <div class="col-12 d-flex gap-2 mt-2">
        <button type="submit" class="btn btn-primary">Guardar orden</button>
        <a th:href="@{/compras/ordenes}" class="btn btn-outline-secondary">Cancelar</a>
      </div>
    </form>
  </div>

</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
